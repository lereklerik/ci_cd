# Домашнее задание к занятию "10.01. Зачем и что нужно мониторить"

## Обязательные задания
--------------------------------------------------------------------------------------------------------------------------

#### 1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

#### Ответ

* **Бизнес-мониторинг**. 
    > Сюда включаются данные, определяющие бизнес-процессы. Они касаются деятельности конечных пользователей. Эти показатели должны включать ключевые бизнес-операции, которые выполняет система.

    * _Основной процесс_: Вычисления с выдачей текстовых отчетов, с записью на диск
    * Предлагаемые метрики:
        1. Время вычисления отчета (минимальное/среднее/максимальное);
        1. Количество сгенерированных отчетов за период;
        1. Скорость поиска требуемого отчета;
        1. Количество просмотров/загрузок отчета.

* **Оценка работоспособности ПО**
    * _Основной процесс_: Вычисления на платформе, генерация отчетов, запись отчетов на диск.
    * Предлагаемые метрики:
        1. Частота ошибок работы платформы;
        1. Ошибки и перезапуск приложения;
        1. Производительность и задержка ответов платформы;
        1. Использование ресурсов;
        1. Состояние и доступность сервиса;
        1. Время отклика платформы;
        1. Количество успешно выполненных операций.

* **Оценка работоспособности оборудования**
    * _Основной процесс_: Выполнение основных процессов платформы: связанных с вычислениями данных, их сохранением, а также с доступом к этим данным.
    * Предлагаемые метрики:
        1. Потребление ресурсов центрального процессора (CPU, % нагрузка на процессор, процессорная очередь, процессорное время);
        1. Объем свободной оперативной памяти, объем свободной виртуальной памяти;
        1. Общий объем дискового пространства, скорость выполнения операций чтения/записи на диск;
        1. Работа служб и функционирование приложений (время отклика);
        1. Объем сетевого трафика между клиентами и сервисом;
        1. Количество открытых соединение с хостом /сервисом;
        1. Если сервис использует БД, то сюда можно добавить количество доступных подключений к БД, объем трафика между сервисом и БД и др.;
        1. Количество одновременных операций в системе (параллелизм); 
        1. Время выполнения операции;
        1. Оценка запасов ресурсов для определения количества резервной мощности при росте нагрузок на платформу;
        1. Частота возникновения ошибок под нагрузкой.


* **Оценка безопасности ИС**. Выделила и это направление в метриках, т.к. общение с сервисом по незащищенному протоколу - очень ненадежная ситуация, даже если сервис внутрисетевой в компании. Следует отметить: что большинство из метрик представляют собой наблюдение за "поведением" сервера и анализа ситуации. Некоторые такие ситуации могут быть проанализированы исключительно человеком.
    * _Основной процесс_: Взаимодействие с платформой по протоколу `http`
    * Предлагаемые метрики:
        1. Наличие несанкционированной (подозрительной) активности на сервере;
        1. Частота нарушений в работе (недоступность) сервиса;
        1. Учет нарушений несанкционированной передачи (утечки) информации;
        1. Количество компрометаций средств аутентификации;    

--------------------------------------------------------------------------------------------------------------------------

#### 2. Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

#### Ответ

* **RAM (Random Access Memory)** - оперативная память. Метрики по ней позволяют оценить загруженность оперативной памяти сервера, на котором развернута платформа;
* **Inodes - объем доступного** пространства для индексных дескрипторов; Метрики доступности дискового пространства позволяют определить скорость записи отчета на диск, оценить нагрузку ПО при вычислении данных и формировании отчета;
* **CPU LA** - Средние значения нагрузки центрального процессора. Нагрузка на процессор определяется как работой платформы, так и сопутствующих систем/сервисов. Метрики позволяют оценить степень этой загруженности и предотвратить возможные инциденты недоступности платформы.

* Для продуктивного взаимодействия с клиентами необходимо заключить соглашение об обслуживании - `SLA (Service Level Agreement)`.
    1. Необходимо прийти к целевому уровню обслуживания `(Service-Level Objective (SLO))`. Для этого необходимо закрепить основные показатели доступности платформы:
        * Допустимое время формирования отчета (макисмальное/минимальное);
        * Допустимое время ожидания ответа сервиса по протоколу `http` (максимальное/минимальное);
        * Допустимый размер сформированного файла отчета (максимальный/минимальный);
        * Допустимое количество/допустимый процент времени на обслуживание платформы и её недоступности для конечных пользователей (максимальное и минимальное время простоя платформы или её недоступности из-за возникших инцидентов);
        * Допустимое значение пропускной способности сети, а также скорости передачи данных (максимальное/минимальное).
    1. Чтобы понимание было ясным, соглашение должно содержать конкретные числовые значения (`Service Level Indicator (SLI)`) определенных выше допустимых показателей.

* `SLO` и `SLI` — это внутренние документы, нужные для взаимодействия команды. Обязанности компании перед клиентами закрепляются в в `SLA`. Это соглашение описывает работоспособность всего сервиса и штрафы за превышение времени простоя или другие нарушения.

--------------------------------------------------------------------------------------------------------------------------

#### 3. Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

#### Ответ

* Основная задача состоит в том,что необходимо понять, какие типы логов необходимы разработчикам, после чего следует выбирать инструмент мониторинга. 
* Бесплатных или условно-бесплатных решений сейчас достаточно много. Какое-то время они могут покрывать потребности разработчиков. 
* Если бесплатных версий будет недостаточно, то уже можно обосновывать необходимость расширения функционала с конкретными примерами использования существующих решений (при условии, что они все-таки были в чем-то эффективны).
* Следует определить, какой тип мониторинга необходимо осуществлять: 
    * Если разработчик работает с определенным стендом, покрыл код логированием, то ему можно предоставить доступ к чтению файла с логами своего функционала. 
    * Если необходимо отслеживать сетевой трафик, то для этого есть достаточно большое количество бесплатных инструментов мониторинга нагрузки сети (к примеру, Zabbix, Icinga). 
    * Можно также настроить сборку логов приложения и визуализацию с помощью ELK, предоставив доступ к просмотру собранных данных разработчикам.
* Не стоит забывать также о том, что некоторые приложения можно использовать условно-бесплатно, как Sentry (где бесплатно можно записывать до 10 тыс багов в месяц). Грамотная настройка позволит не выходит за рамки дозволенного.
* И я не могу не упомянуть про бесплатный Jenkins, несмотря на то, что он больше подходит для CI/CD. При грамотной разработке и настройке пайплайнов можно считывать логи тестирования приложения (а разработку обязательно нужно покрывать тестами). 

--------------------------------------------------------------------------------------------------------------------------

#### 4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

#### Ответ

* Коды ответов http-запросов следующие:
    - Информационные (100 - 199)
    - Успешные (200 - 299)
    - Перенаправления (300 - 399)
    - Клиентские ошибки (400 - 499)
    - Серверные ошибки (500 - 599)
* Формула из задания учитывает только диапазон кодовых ответов 200-299. Однако диапазоны 100-199 и 300-399 не являются ошибками. Их также следует учитывать при расчете `SLI`:

    > SLI = (summ_1xx_requests + summ_2xx_requests + summ_3xx_requests)/(summ_all_requests)

--------------------------------------------------------------------------------------------------------------------------